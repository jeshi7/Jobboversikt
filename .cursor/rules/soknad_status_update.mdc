---
description: Automatisk oppdatering av status basert pÃ¥ innhold i bedriftsmappe
globs: 02_SÃ¸knader/Alle selskaper/**/*
---

### ğŸ”„ Statuslogikk for SÃ¸knader (KRITISK)

Statusen til en sÃ¸knad bestemmes av **hva som ligger i bedriftsmappen** i `Alle selskaper/`:

**NivÃ¥ 1: "Under planlegging" / "Planlagt"**
- Mappen inneholder **bare** `Utlysning.md`
- Ingen andre filer er lagt til ennÃ¥
- Vises i "ğŸŸ¡ Under planlegging" i SÃ¸knadsoversikt
- Vises i "Planlagt"-kolonnen i appen

**NivÃ¥ 2: "Under arbeid" / "Forbereder"**
- Mappen inneholder `Utlysning.md` **pluss** andre filer (f.eks. `CV-profile.md`, `SÃ¸knadsbrev.md`, notater)
- Men IKKE begge PDF-er ennÃ¥
- Vises i "ğŸŸ¢ Aktive Prosesser" med status `ğŸ“ Under arbeid`
- Vises i "Forbereder"-kolonnen i appen (kolonnen "Notat / sÃ¸knad" viser "Forbereder" nÃ¥r det mangler begge PDF-filer)

**NivÃ¥ 3: "Sendt"**
- Mappen inneholder **begge PDF-er**:
  - âœ… `CV - [Navn].pdf`
  - âœ… `SÃ¸knadsbrev - [Bedrift].pdf` eller `Cover Letter - [Bedrift].pdf`
- Vises i "ğŸŸ¢ Aktive Prosesser" med status `âœ‰ï¸ Sendt`
- Vises i "Sendt sÃ¸knad"-kolonnen i appen (kolonnen "Notat / sÃ¸knad" viser "Sendt sÃ¸knad" nÃ¥r begge PDF-filer er pÃ¥ plass)
- `Dato sendt` fylles ut med dagens dato
- Nedtelling starter for Kontakt 1 (3 dager etter sendt), deretter Kontakt 2-5 (7 dager etter forrige kontakt)

**NivÃ¥ 4: "AvslÃ¥tt" / "Ansatt"**
- Status bestemmes av "Tilbud"-feltet i SÃ¸knadsoversikt.md:
  - Hvis "Tilbud" = **"ja"**: Status blir `AvslÃ¥tt` (rÃ¸d tag i appen)
  - Hvis "Tilbud" = **"nei"**: Status blir `Ansatt` (grÃ¸nn tag i appen)
- Disse statusene overstyrer alle andre statuser
- Vises i appen med henholdsvis "Avslag" (rÃ¸d) og "Ansatt" (grÃ¸nn) tags

**Eksempler:**

```
Alle selskaper/E-Wheels Norge/
â”œâ”€â”€ Utlysning.md                    â† BARE denne = "Under planlegging"

Alle selskaper/Norwegian/
â”œâ”€â”€ Utlysning.md
â”œâ”€â”€ CV-profile.md                   â† Arbeid startet = "Under arbeid"
â”œâ”€â”€ SÃ¸knadsbrev.md

Alle selskaper/Oda/
â”œâ”€â”€ Utlysning.md
â”œâ”€â”€ CV - Jessie Macharia.pdf        âœ…
â”œâ”€â”€ SÃ¸knadsbrev - Oda.pdf           âœ…  â† Begge PDF = "Sendt"
```

**NÃ¥r status endres:**

1.  **Planlagt â†’ Under arbeid:**
    *   NÃ¥r fÃ¸rste fil utover `Utlysning.md` legges til
    *   Flytt fra "Under planlegging" til "Aktive Prosesser"
    *   Slett filen fra `Planlagte_SÃ¸knader/` hvis den finnes der
    *   Status: `ğŸ“ Under arbeid`

2.  **Under arbeid â†’ Sendt:**
    *   NÃ¥r BEGGE PDF-er er pÃ¥ plass
    *   Status: `âœ‰ï¸ Sendt`
    *   Fyll ut `Dato sendt` med dagens dato

**"Notat / sÃ¸knad"-kolonne i appen:**
- **"Planlagt idÃ© / notat"**: For selskaper i `Planlagte_SÃ¸knader/` eller mapper med bare `Utlysning.md`
- **"Forbereder"**: For selskaper i `Alle selskaper/` som mangler begge PDF-filer (enten ingen eller bare Ã©n PDF)
- **"Sendt sÃ¸knad"**: For selskaper i `Alle selskaper/` som har begge PDF-filer (CV og sÃ¸knadsbrev/cover letter)

**Kontakt-oppfÃ¸lging (5 kontakter):**
- Systemet stÃ¸tter opptil **5 kontakter** per sÃ¸knad
- **Kontakt 1**: 3 dager etter "Dato sendt" - vises nÃ¥r sÃ¸knad er sendt
- **Kontakt 2-5**: 7 dager etter forrige kontakt - vises automatisk nÃ¥r forrige kontakt-notat er lagret
- NÃ¥r et kontakt-notat lagres:
  - Notatet lagres som `Kontakt[N]-Notat.md` i selskapets mappe
  - SÃ¸knadsoversikt.md oppdateres automatisk med dagens dato i riktig "Kontakt N"-kolonne
  - Neste kontakt vises automatisk i appen
- For Kontakt 2-5 vises lenker til alle forrige kontakt-notater i popup-en
- Brukeren kan toggle mellom "Kontakt" og "Intervju" i "Hva du kan gjÃ¸re nÃ¥"-seksjonen
- Eksisterende notater vises i read-only modus med "Rediger"-knapp for Ã¥ aktivere redigering
- **Rediger fra visnings-popup**: NÃ¥r brukeren klikker "Rediger" i visnings-popup (for tidligere notater), Ã¥pnes redigerings-popup direkte i redigeringsmodus - ingen ekstra klikk nÃ¸dvendig
- **FeilhÃ¥ndtering**: Hvis lagring feiler, vises en rÃ¸d feilmelding i popup-en med detaljer om hva som gikk galt

**Intervju-oppfÃ¸lging (4 intervjuer):**
- Systemet stÃ¸tter opptil **4 intervjuer** per sÃ¸knad
- **Intervju 1**: Vises nÃ¥r sÃ¸knad er sendt eller i dialog
- **Intervju 2-4**: Vises automatisk nÃ¥r forrige intervju-notat er lagret
- NÃ¥r et intervju-notat lagres:
  - Notatet lagres som `Intervju[N]-Notat.md` i selskapets mappe
  - SÃ¸knadsoversikt.md oppdateres automatisk med dagens dato i riktig "Intervju N"-kolonne
  - Neste intervju vises automatisk i appen
- For Intervju 2-4 vises lenker til alle forrige intervju-notater i popup-en
- Samme rediger-funksjonalitet som for kontakter (direkte redigeringsmodus fra visnings-popup)

**Notat-lagring (ContactReminders-komponenten):**
- `ContactReminders.tsx` hÃ¥ndterer bÃ¥de kontakt- og intervju-notater
- **Lagre-knappen**: Klikk "Lagre" for Ã¥ lagre notatet - det lagres via `/api/contact-notes` API
- **Rediger-flyt**: NÃ¥r du klikker "Rediger" fra en visnings-popup, Ã¥pnes redigerings-popup direkte i redigeringsmodus (skipFetch-mekanisme)
- **Feilmelding**: Hvis API-kallet feiler, vises en rÃ¸d feilboks med detaljert informasjon
- **Automatisk oppdatering**: Etter vellykket lagring lukkes popup-en og siden lastes pÃ¥ nytt for Ã¥ vise oppdaterte data

**Dokumentlenker:**
- Filer som matcher "Utlysning.md" eller lignende (`.md`-filer med "utlysning" i navnet) lenker til `listingUrl` fra utlysningen i stedet for Ã¥ laste ned filen
- Dette gjelder bÃ¥de i ResourceCard og PipelineBoard popups
- Andre dokumenter (CV, sÃ¸knadsbrev, etc.) lenker fortsatt til `/api/files` for nedlasting

**Status-tags i appen:**
- **Planlagt** (nÃ¸ytral): SÃ¸knad er planlagt, ikke startet
- **Forberedes** (nÃ¸ytral): Arbeid har startet, men ikke begge PDF-er klare
- **Sendt** (grÃ¸nn): Begge PDF-er er klare og sendt
- **Intervju** (gul): Intervju er planlagt eller gjennomfÃ¸rt
- **Avslag** (rÃ¸d): "Tilbud"-feltet i SÃ¸knadsoversikt.md er satt til "ja"
- **Ansatt** (grÃ¸nn): "Tilbud"-feltet i SÃ¸knadsoversikt.md er satt til "nei"

**Hvorfor?**
For Ã¥ ha presis kontroll over hvor i prosessen hver sÃ¸knad er. Bare det Ã¥ ha en mappe klar betyr ikke at arbeidet har startet. "Notat / sÃ¸knad"-kolonnen gir rask visuell indikasjon pÃ¥ om sÃ¸knaden er klar til Ã¥ sendes eller ikke.
